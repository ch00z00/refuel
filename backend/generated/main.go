// Code generated by OpenAPI Generator (https://openapi-generator.tech); DO NOT EDIT.

/*
 * Re:Fuel API
 *
 * コンプレックスを燃料に変える自己進化アプリ「Re:Fuel」のAPI仕様書です。 MVP（Minimum Viable Product）の機能を対象としています。
 *
 * API version: v1.0.0
 */

package main

import (
	"log"
	"net/http"

	"refuel/backend/app"
	refuelapi "refuel/backend/generated/go"

	"github.com/gin-gonic/gin"
)

func main() {
	// アプリケーションコンテキストの初期化 (DB接続、バリデーター、マイグレーションなど)
	log.Printf("Server started")

	// Ginルーターの初期化
	r := gin.Default()

	// アプリケーションコンテキストの初期化 (DB接続、バリデーター、マイグレーションなど)
	appCtx, err := app.SetupApp()
	if err != nil {
		log.Fatalf("Failed to setup application: %v", err)
	}

	// APIサービスの実装を生成されたコントローラに渡す
	apiService := app.NewAPIService(appCtx.DB, appCtx.Validate)

	// ルーティングの設定
	refuelapi.NewRouter(
		refuelapi.NewActionsAPIController(apiService),
		refuelapi.NewBadgesAPIController(apiService),
		refuelapi.NewComplexesAPIController(apiService),
		refuelapi.NewGoalsAPIController(apiService),
		refuelapi.NewHealthAPIController(apiService),
		refuelapi.NewUserBadgesAPIController(apiService),
	)

	// Ginミドルウェアの設定
	app.SetupGinMiddlewares(r)

	log.Fatal(http.ListenAndServe(":8080", r))
}
